<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Week 10 – Home Edition (Shoulder Rehab + KB Strength)</title>
<style>
  :root{ --bg:#0b1320; --card:#111a2c; --ink:#e9eef8; --muted:#a9b5cf; --accent:#3ddc97; --accent2:#8ab4ff; --warn:#ffd166; }
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif}
  .wrap{max-width:980px;margin:0 auto;padding:24px}
  header{position:sticky;top:0;background:linear-gradient(180deg,#0b1320,rgba(11,19,32,.85));backdrop-filter:blur(6px);z-index:5;border-bottom:1px solid #1f2a44}
  header .bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;padding:12px 24px}
  h1{font-size:1.6rem;margin:.2rem 0}
  .tag{font-size:.8rem;color:var(--bg);background:var(--accent);border-radius:999px;padding:.15rem .6rem;font-weight:700}
  .card{background:var(--card);border:1px solid #1f2a44;border-radius:16px;padding:16px;margin-top:12px}
  .muted{color:var(--muted)}
  .pill{display:inline-block;background:#17233a;padding:.15rem .5rem;border-radius:999px;margin-left:.35rem;border:1px solid #223055}
  details{border:1px solid #233055;border-radius:12px;padding:.6rem .8rem;background:#0e1830}
  details+details{margin-top:10px}
  details>summary{cursor:pointer;font-weight:700}
  .rx{display:grid;grid-template-columns: 1fr; gap:8px;margin:.4rem 0 .6rem}
  .ok{color:var(--accent)}
  .warn{color:var(--warn)}
  .list{margin:.2rem 0 0 1rem}
  .check{list-style:"✔  ";}
  .danger{list-style:"⚠  ";}
  .day-controls{display:flex;gap:8px;flex-wrap:wrap;margin:.25rem 0 .5rem}
  .button{background:#17233a;color:var(--ink);border:1px solid #2a365a;padding:.35rem .6rem;border-radius:8px;cursor:pointer}
  .button:hover{border-color:var(--accent2)}
  .timer{display:inline-flex;align-items:center;gap:6px;margin-left:8px;background:#17233a;padding:3px 8px;border-radius:999px;border:1px solid #223055;font-variant-numeric:tabular-nums}
  .timer-complete{border-color:var(--accent);box-shadow:0 0 0 1px rgba(61,220,151,.3)}
  .timer-display{font-weight:700;letter-spacing:.03em}
  .timer button{background:transparent;border:1px solid #2a365a;color:var(--ink);padding:2px 6px;border-radius:6px;cursor:pointer;font-size:.85rem}
  .timer button:hover{border-color:var(--accent2)}
  .emom-tracker{margin-top:10px;padding:12px;border:1px solid #223055;border-radius:12px;background:#0e1830}
  .emom-headline{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  .emom-clock{font-weight:700;font-size:1.1rem;font-variant-numeric:tabular-nums}
  .emom-now{color:var(--accent2);font-weight:700}
  .emom-controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .emom-controls button{background:transparent;border:1px solid #2a365a;color:var(--ink);padding:4px 10px;border-radius:8px;cursor:pointer}
  .emom-controls button:hover{border-color:var(--accent2)}
  .emom-steps{margin:10px 0 0 1.2rem;padding:0}
  .emom-steps li{padding:2px 0}
  .emom-step-active{color:var(--accent);font-weight:700}
</style>
</head>
<body>
<header>
  <div class="bar wrap">
    <h1>Week 10 — Home Edition</h1>
    <span class="tag">Kettlebell Focus + Metabolic Rehab</span>
  </div>
</header>
<main class="wrap">

<section class="card callout">
  <b>Home Edition: How to use</b>
  <ul>
    <li><b>Equipment Profile:</b> 2×20kg KBs (Heavy), 1×12kg KB (Rehab/Skill), Barbell (≈20–30kg), Mat.</li>
    <li><b>Modifications:</b> Runs are replaced by <b>Metabolic Conditioning</b> (Swings/Intervals) to match heart rate stimulus without impact.</li>
    <li><b>Pain rule:</b> 0–3/10 is acceptable. Stop for sharp/catching pain.</li>
  </ul>
</section>

<section class="card callout">
  <b>Week 10 Defaults</b>
  <ul>
    <li><b>Main Lifts:</b> <b>Double Rack Squats</b> replace Back Squats (higher core demand). <b>Single-Leg/Staggered RDLs</b> replace heavy deadlifts.</li>
    <li><b>Overhead Safety:</b> Use the <b>12kg KB</b> or <b>Light Barbell</b> for overhead pressing. Do not force the 20kg overhead if unstable.</li>
    <li><b>Elbow Rehab:</b> Use the <b>12kg KB</b> for eccentric wrist extensions (assist up, lower slow).</li>
    <li><b>Conditioning:</b> High-intensity intervals using KB Swings and Bodyweight to replace running volume.</li>
  </ul>
</section>

<section id="week10" class="card">
  <h2>Week 10 – Alternating Days (Weights ↔ MetCon)</h2>
  <p class="muted">Modified for home equipment constraints. Focus on stability and time-under-tension.</p>
  
  <div class="day-controls">
    <button type="button" class="button" onclick="toggleDetails(document.querySelector('#week10'), true)">➕ Expand all (Week 10)</button>
    <button type="button" class="button" onclick="toggleDetails(document.querySelector('#week10'), false)">➖ Collapse all (Week 10)</button>
  </div>

  <div class="card">
    <h3>Monday — Integrated Strength (Home Var.)</h3>
    <div class="day-controls">
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), true)">➕ Expand all</button>
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), false)">➖ Collapse all</button>
    </div>
    <div class="rx">
      <details><summary><b>Movement Preparation</b> — 2 rounds</summary>
        <ul class="list check">
          <li><b>Arm Circles/Rolls:</b> Standard warm-up.</li>
          <li><b>Cat-Cow:</b> 8 reps.</li>
          <li><b>Thoracic Rotations:</b> 6 reps/side.</li>
          <li><b>Wall Handstand:</b> 2 × 25s (Press floor away, ribs down). <span class="timer" data-seconds="25"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
          <li><b>Hollow Hold:</b> 2 × 20s (Lower back pinned to floor). <span class="timer" data-seconds="20"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
        </ul>
      </details>

      <details><summary><b>Double KB Front Squat</b> — <b>3×6–8</b> @ RPE 7 <span class="pill">Main Lift</span></summary>
        <ul class="list check">
          <li><b>Setup:</b> Clean both 20kg KBs to "Rack" position (knuckles under chin, elbows tucked).</li>
          <li><b>Action:</b> Squat deep. Keep chest tall to fight the weight pulling you forward.</li>
          <li><b>Note:</b> If 2×20kg is too heavy, use 1×20kg (Goblet) or the Barbell for 12–15 reps.</li>
        </ul>
      </details>

      <details><summary><b>Single-Leg RDL</b> — <b>3×8 each leg</b> <span class="pill">Balance Focus</span></summary>
        <ul class="list check">
          <li><b>Setup:</b> Hold ONE 20kg KB in the hand <i>opposite</i> the standing leg.</li>
          <li><b>Action:</b> Hinge hips back, floating free leg behind. Keep back flat.</li>
          <li><b>Focus:</b> Anti-rotation. Don't let the weight twist you.</li>
        </ul>
      </details>

      <details><summary><b>Superset: Gorilla Row + Press</b> — <b>3×8–10 each</b></summary>
        <ul class="list check">
          <li><b>KB Gorilla Row:</b> Wide stance, KBs on floor. Row one KB while pushing the other into the floor. 8-10 reps/side.</li>
          <li><b>Overhead Press:</b> Use <b>12kg KB</b> or <b>Barbell</b>. Strict press. 8-10 reps.</li>
        </ul>
        <ul class="list danger"><li>Caution: Do not use 20kg for press if shoulder feels unstable.</li></ul>
      </details>

      <details><summary><b>Push-Up Complex</b> — 3 rounds</summary>
        <ul class="list check">
          <li><b>8 Push-Up Plus:</b> Protract/Retract at top.</li>
          <li><b>5 Pike Push-Ups:</b> Hips high.</li>
          <li><b>5 Single-Arm var:</b> Wall or elevated if needed.</li>
        </ul>
      </details>

      <details><summary><b>Forearm Rehab (12kg KB)</b> — 3×12</summary>
        <ul class="list check">
          <li><b>Eccentric Wrist Extension:</b> Forearm on table. Use 12kg. Lift with help, lower SLOWLY (5s).</li>
          <li><b>KB Halo:</b> Hold 12kg by horns. Circle around head. 10 each way.</li>
        </ul>
      </details>
    </div>
  </div>

  <div class="card">
    <h3>Tuesday — Metabolic Conditioning (No Run)</h3>
    <div class="day-controls">
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), true)">➕ Expand all</button>
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), false)">➖ Collapse all</button>
    </div>
    <div class="rx">
      <details><summary><b>Foot + Ankle Complex</b> — 3 rounds <span class="pill">Critical</span></summary>
        <ul class="list check">
          <li><b>Short-Foot Drill:</b> 40s hold per foot. <span class="timer" data-seconds="40"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
          <li><b>Tibialis Raises:</b> Lean on wall, lift toes. 15 reps.</li>
          <li><b>Calf Stretch:</b> 30s each. <span class="timer" data-seconds="30"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
        </ul>
      </details>

      <details><summary><b>The "No-Run" Circuit</b> — 5 Rounds <span class="pill">Heart Rate Focus</span></summary>
        <ul class="list check">
          <li><b>Instructions:</b> Perform exercises back-to-back. Rest 90s between rounds. <span class="timer" data-seconds="90"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
          <li><b>1. KB Swings (20kg):</b> 20 reps. Snap hips, do not squat.</li>
          <li><b>2. Mountain Climbers:</b> 30 seconds fast pace. <span class="timer" data-seconds="30"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
          <li><b>3. Bear Crawl:</b> 10 steps forward, 10 steps back. Keep knees hovering.</li>
          <li><b>4. Farmer's March:</b> Hold 2×20kg. High knee march in place. 45 seconds. <span class="timer" data-seconds="45"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
        </ul>
      </details>

      <details><summary><b>Scapular & Rehab Finisher</b> — 2 sets</summary>
        <ul class="list check">
          <li><b>Towel/Band Pull-Aparts:</b> 15 reps.</li>
          <li><b>Push-Up Plus:</b> 15 reps. Focus on scapular movement.</li>
        </ul>
      </details>
    </div>
  </div>

  <div class="card">
    <h3>Wednesday — Offset Strength & Stability</h3>
    <div class="day-controls">
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), true)">➕ Expand all</button>
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), false)">➖ Collapse all</button>
    </div>
    <div class="rx">
      <details><summary><b>Movement Prep</b> — 2 rounds</summary>
        <ul class="list check">
          <li>Standard mobility + 1 minute Bear Crawl. <span class="timer" data-seconds="60"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
        </ul>
      </details>

      <details><summary><b>Offset Squat</b> — <b>3×6 each side</b> <span class="pill">Core Challenge</span></summary>
        <ul class="list check">
          <li><b>Setup:</b> Rack 20kg KB on Left side, 12kg KB on Right side.</li>
          <li><b>Action:</b> Squat. Fight the uneven weight to stay upright.</li>
          <li><b>Switch:</b> Perform 6 reps, switch weights, repeat.</li>
        </ul>
      </details>

      <details><summary><b>Staggered Stance RDL</b> — <b>3×8 each side</b></summary>
        <ul class="list check">
          <li><b>Setup:</b> Hold 2×20kg (or 1×20kg). Place one foot 6 inches behind other (kickstand).</li>
          <li><b>Action:</b> Hinge hips. 80% of weight on front leg. feel the hamstring.</li>
        </ul>
      </details>

      <details><summary><b>Floor Press</b> — <b>3×10–12</b> <span class="pill">Chest/Triceps</span></summary>
        <ul class="list check">
          <li><b>Setup:</b> Lie on mat. Knees bent. Hold 2×20kg (or single arm if 2 is hard to position).</li>
          <li><b>Action:</b> Press up. Lower until triceps tap floor.</li>
          <li><b>Note:</b> Safer for shoulders than bench press as range is limited by floor.</li>
        </ul>
      </details>

      <details><summary><b>Turkish Get-Up</b> — <b>3×2 each side</b></summary>
        <ul class="list check">
          <li><b>Weight:</b> Use the <b>12kg KB</b>.</li>
          <li><b>Focus:</b> Perfect technique. Keep eyes on the weight.</li>
        </ul>
      </details>

      <details><summary><b>Grip Crush Finisher</b> — 3 sets</summary>
        <ul class="list check">
          <li><b>Farmer Hold:</b> Hold 2×20kg at sides. Squeeze handles hard. Hold until failure.</li>
          <li>Rest 60s.</li>
        </ul>
      </details>
    </div>
  </div>

  <div class="card">
    <h3>Thursday — Metabolic Conditioning (EMOM)</h3>
    <div class="day-controls">
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), true)">➕ Expand all</button>
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), false)">➖ Collapse all</button>
    </div>
    <div class="rx">
      <details><summary><b>Foot + Ankle Complex</b> — 3 rounds</summary>
        <ul class="list check">
          <li>Short-Foot Drill, Ankle Circles, Tibialis Raises.</li>
        </ul>
      </details>

      <details><summary><b>EMOM 20</b> — 20 Minutes total <span class="pill">Conditioning</span> <span class="timer" data-seconds="1200"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></summary>
        <ul class="list check">
          <li><b>Format:</b> Start a new exercise every minute. Rest for remainder of minute.</li>
          <li><b>Min 1:</b> 15 Goblet Squats (12kg or 20kg).</li>
          <li><b>Min 2:</b> 10 Push-Ups + 10 Mountain Climbers.</li>
          <li><b>Min 3:</b> 15 KB Swings (20kg).</li>
          <li><b>Min 4:</b> 45 sec Plank Hold. <span class="timer" data-seconds="45"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
          <li><b>Repeat:</b> Cycle through this list 5 times total.</li>
        </ul>
        <div class="emom-tracker" data-total-minutes="20" data-steps='["Min 1: 15 Goblet Squats (12–20kg)","Min 2: 10 Push-Ups + 10 Mountain Climbers","Min 3: 15 KB Swings (20kg)","Min 4: 45s Plank Hold"]'>
          <div class="emom-headline">
            <div><strong>EMOM Timer with Beep</strong> <span class="emom-clock"></span></div>
            <div class="emom-now">Ready: Min 1</div>
          </div>
          <div class="emom-controls">
            <button type="button" class="emom-start">Start</button>
            <button type="button" class="emom-reset">Reset</button>
            <label><input type="checkbox" class="emom-sound" checked /> Beep each minute</label>
          </div>
          <ol class="emom-steps"></ol>
        </div>
      </details>

      <details><summary><b>Wall Mobility</b> — 3×10</summary>
        <ul class="list check">
          <li><b>Wall Slides:</b> W to Y pattern. Keep lower back flat.</li>
          <li><b>Wall Angels:</b> Snow angel motion.</li>
        </ul>
      </details>
    </div>
  </div>

  <div class="card">
    <h3>Friday — Peak Integrated Strength</h3>
    <div class="day-controls">
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), true)">➕ Expand all</button>
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), false)">➖ Collapse all</button>
    </div>
    <div class="rx">
      <details><summary><b>Movement Prep</b> — 3 rounds</summary>
        <ul class="list check">
          <li>Comprehensive warm-up (Circles, Cat-Cow, Leg Swings).</li>
        </ul>
      </details>

      <details><summary><b>The KB Complex</b> — 3×5 each side <span class="pill">Flow</span></summary>
        <ul class="list check">
          <li><b>Weight:</b> Single 12kg or 20kg.</li>
          <li><b>Sequence:</b> 1 Goblet Squat → 1 Single-Arm Press → 1 Reverse Lunge → 1 Row.</li>
          <li>Perform sequence 5 times on Left, then 5 times on Right.</li>
        </ul>
      </details>

      <details><summary><b>Heavy KB Deadlift</b> — <b>4×10–12</b></summary>
        <ul class="list check">
          <li><b>Setup:</b> Both 20kg KBs between feet (Sumo) or at sides (Suitcase).</li>
          <li><b>Action:</b> Hinge hips, keeping back flat. Squeeze glutes at top.</li>
          <li><b>Note:</b> Higher reps because total weight (40kg) is relatively light.</li>
        </ul>
      </details>

      <details><summary><b>Push-Pull Density Circuit</b> — 10 Minutes <span class="pill">AMRAP Quality</span> <span class="timer" data-seconds="600"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></summary>
        <ul class="list check">
          <li><b>Timer:</b> 10 Minutes. Perform as many <i>quality</i> rounds as possible.</li>
          <li><b>1. Overhead Press (Barbell/12kg):</b> 8 reps.</li>
          <li><b>2. KB Rows (20kg):</b> 8 reps/side.</li>
          <li><b>3. Push-Up Plus:</b> 10 reps.</li>
        </ul>
      </details>

      <details><summary><b>Living Room Carry Medley</b> — 3 rounds</summary>
        <ul class="list check">
          <li><b>Rack Carry (2×20kg):</b> 60s march in place. <span class="timer" data-seconds="60"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
          <li><b>Overhead Carry (1×12kg):</b> 30s walk/march per side. <span class="timer" data-seconds="30"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
          <li><b>Suitcase Carry (1×20kg):</b> 30s walk/march per side. <span class="timer" data-seconds="30"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
        </ul>
      </details>
    </div>
  </div>

  <div class="card">
    <h3>Saturday — Endurance ("The Century")</h3>
    <div class="day-controls">
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), true)">➕ Expand all</button>
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), false)">➖ Collapse all</button>
    </div>
    <div class="rx">
      <details><summary><b>Foot + Ankle Complex</b> — 3 rounds</summary>
        <ul class="list check">
          <li>Short-Foot Drill, Ankle Circles, Tibialis Raises.</li>
        </ul>
      </details>

      <details><summary><b>"The Century" Chipper</b> — For Time <span class="pill">Endurance</span></summary>
        <ul class="list check">
          <li><b>Instructions:</b> Complete all reps. Break sets as needed.</li>
          <li><b>50 KB Swings</b> (20kg).</li>
          <li><b>50 Push-Ups</b> (Use incline/knees if form breaks).</li>
          <li><b>50 Lunges</b> (Bodyweight, alternating legs).</li>
          <li><b>50 KB Rows</b> (Total reps. 25/side. Use 12kg or 20kg).</li>
          <li><b>50 Glute Bridges</b> (Lying on floor).</li>
        </ul>
      </details>

      <details><summary><b>Advanced Scapular Control</b> — 2×10</summary>
        <ul class="list check">
          <li><b>Prone T-Y-I:</b> Lie face down. Lift arms in T shape, then Y, then I.</li>
          <li>Control the movement with shoulder blades.</li>
        </ul>
      </details>
    </div>
  </div>

  <div class="card">
    <h3>Sunday — Recovery + Assessment</h3>
    <div class="day-controls">
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), true)">➕ Expand all</button>
      <button type="button" class="button" onclick="toggleDetails(this.closest('.card'), false)">➖ Collapse all</button>
    </div>
    <div class="rx">
      <details><summary><b>Active Recovery</b> — 40 min <span class="timer" data-seconds="2400"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></summary>
        <ul class="list check">
          <li><b>Walk:</b> 40 minute walk outdoors if possible. <span class="timer" data-seconds="2400"><span class="timer-display"></span><button type="button" class="timer-toggle">Start</button><button type="button" class="timer-reset">Reset</button></span></li>
          <li><b>Mobility:</b> Focus on Thoracic Spine (Cat-Cow, Open Book stretches).</li>
        </ul>
      </details>
      <details><summary><b>Self-Assessment</b></summary>
        <ul class="list check">
          <li>Check overhead range of motion vs Week 1.</li>
          <li>Check elbow pain levels (should be trending down).</li>
        </ul>
      </details>
    </div>
  </div>

</section>
</main>
<script>
function toggleDetails(scope, open){
  var root = scope || document;
  root.querySelectorAll('details').forEach(function(d){ d.open = open; });
}

function initTimers(){
  var timers = document.querySelectorAll('.timer');
  timers.forEach(function(timerEl){
    var baseSeconds = parseInt(timerEl.dataset.seconds, 10);
    if (isNaN(baseSeconds)) return;

    var display = timerEl.querySelector('.timer-display');
    var toggle = timerEl.querySelector('.timer-toggle');
    var reset = timerEl.querySelector('.timer-reset');
    var remaining = baseSeconds;
    var ticker = null;

    timerEl.addEventListener('click', function(ev){ ev.stopPropagation(); });
    timerEl.querySelectorAll('button').forEach(function(btn){ btn.type = 'button'; });

    function format(seconds){
      var mins = Math.floor(seconds / 60);
      var secs = seconds % 60;
      return String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
    }

    function render(){
      if (display) display.textContent = format(remaining);
    }

    function stop(){
      if (ticker){
        clearInterval(ticker);
        ticker = null;
      }
    }

    function start(){
      var startTimestamp = Date.now();
      var snapshot = remaining;
      timerEl.classList.remove('timer-complete');
      ticker = setInterval(function(){
        var elapsed = Math.floor((Date.now() - startTimestamp) / 1000);
        remaining = snapshot - elapsed;
        if (remaining <= 0){
          remaining = 0;
          render();
          stop();
          toggle.textContent = 'Start';
          timerEl.classList.add('timer-complete');
          return;
        }
        render();
      }, 250);
    }

    if (toggle){
      toggle.addEventListener('click', function(){
        if (ticker){
          stop();
          toggle.textContent = 'Start';
        } else {
          toggle.textContent = 'Pause';
          start();
        }
      });
    }

    if (reset){
      reset.addEventListener('click', function(){
        stop();
        remaining = baseSeconds;
        render();
        timerEl.classList.remove('timer-complete');
        if (toggle) toggle.textContent = 'Start';
      });
    }

    render();
  });
}

initTimers();

function createBeep(){
  var ctx = null;
  return function(){
    try{
      ctx = ctx || new (window.AudioContext || window.webkitAudioContext)();
      if (ctx.state === 'suspended') ctx.resume();
      var osc = ctx.createOscillator();
      var gain = ctx.createGain();
      osc.type = 'sine';
      osc.frequency.value = 880;
      gain.gain.value = 0.0001;
      osc.connect(gain);
      gain.connect(ctx.destination);
      var now = ctx.currentTime;
      gain.gain.exponentialRampToValueAtTime(0.25, now + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.25);
      osc.start();
      osc.stop(now + 0.3);
    } catch(err){
      console && console.warn && console.warn('Audio beep unavailable', err);
    }
  };
}

function initEmomTrackers(){
  var beep = createBeep();
  var trackers = document.querySelectorAll('.emom-tracker');
  trackers.forEach(function(box){
    box.addEventListener('click', function(ev){ ev.stopPropagation(); });

    var totalMinutes = parseInt(box.dataset.totalMinutes, 10) || 0;
    var steps = [];
    try { steps = JSON.parse(box.dataset.steps || '[]'); } catch(e){ steps = []; }

    var clock = box.querySelector('.emom-clock');
    var nowEl = box.querySelector('.emom-now');
    var startBtn = box.querySelector('.emom-start');
    var resetBtn = box.querySelector('.emom-reset');
    var soundToggle = box.querySelector('.emom-sound');
    var stepsList = box.querySelector('.emom-steps');

    if (stepsList && steps.length){
      stepsList.innerHTML = '';
      for (var i = 0; i < totalMinutes; i++){
        var label = steps[i % steps.length];
        var li = document.createElement('li');
        li.textContent = 'Minute ' + (i + 1) + ': ' + label;
        li.dataset.minute = i;
        stepsList.appendChild(li);
      }
    }

    var state = { ticker:null, elapsedMs:0, lastMinute:-1, running:false, startedAt:0 };

    function format(ms){
      var totalSeconds = Math.max(0, Math.ceil(ms / 1000));
      var mins = Math.floor(totalSeconds / 60);
      var secs = totalSeconds % 60;
      return String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
    }

    function setNow(minuteIdx){
      var label = steps.length ? steps[minuteIdx % steps.length] : ('Minute ' + (minuteIdx + 1));
      if (nowEl){
        nowEl.textContent = 'Now: ' + label;
      }
      if (stepsList){
        stepsList.querySelectorAll('li').forEach(function(li){
          li.classList.toggle('emom-step-active', parseInt(li.dataset.minute, 10) === minuteIdx);
        });
      }
    }

    function render(){
      var remainingMs = Math.max((totalMinutes * 60000) - state.elapsedMs, 0);
      if (clock) clock.textContent = format(remainingMs);
    }

    function stop(){
      if (state.ticker){
        clearInterval(state.ticker);
        state.ticker = null;
      }
      state.running = false;
      if (startBtn) startBtn.textContent = 'Start';
    }

    function tick(){
      var now = performance.now();
      var elapsed = state.elapsedMs + (now - state.startedAt);
      var totalDuration = totalMinutes * 60000;
      if (elapsed >= totalDuration){
        state.elapsedMs = totalDuration;
        render();
        stop();
        return;
      }
      state.elapsedMs = elapsed;
      var minuteIdx = Math.floor(elapsed / 60000);
      if (minuteIdx !== state.lastMinute){
        for (var m = state.lastMinute + 1; m <= minuteIdx; m++){
          setNow(m);
          if (!soundToggle || soundToggle.checked) beep();
        }
        state.lastMinute = minuteIdx;
      }
      render();
    }

    function start(){
      if (state.running) return;
      state.startedAt = performance.now();
      state.running = true;
      state.ticker = setInterval(tick, 200);
      tick();
      if (startBtn) startBtn.textContent = 'Pause';
    }

    function pause(){
      if (!state.running) return;
      state.elapsedMs += performance.now() - state.startedAt;
      stop();
    }

    function reset(){
      stop();
      state.elapsedMs = 0;
      state.lastMinute = -1;
      setNow(0);
      render();
    }

    if (startBtn){
      startBtn.addEventListener('click', function(){
        if (state.running){
          pause();
        } else {
          start();
        }
      });
    }
    if (resetBtn){
      resetBtn.addEventListener('click', function(){
        reset();
      });
    }

    render();
    setNow(0);
  });
}

initEmomTrackers();
</script>
</body>
</html>
